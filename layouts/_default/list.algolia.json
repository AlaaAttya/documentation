{{- $.Scratch.Add "algoliaindex" slice -}}
{{- $section := $.Site.GetPage "section" .Section -}}
{{- $hugo_context := . -}}

{{- range (where .Site.AllPages "Kind" "!=" "home") -}}
    {{- $page := . -}}
    {{- if and ($page.IsDescendant $section) (ne $page.Params.private true) (ne $page.Params.kind "faq") (ne $page.Params.beta true) (not $page.Draft) (not (isset .Params "external_redirect")) (not (isset .Params "placeholder")) -}}
        {{- $title := $page.Params.integration_title | default $page.Title -}}
        {{- $content := $page.Content | htmlUnescape | plainify | truncate 3000 -}}
    {{- end -}}
{{- end -}}

{{- /* Outputs final JSON object, copied to public/ folder. */ -}}
{{- $.Scratch.Get "algoliaindex" | jsonify -}}
